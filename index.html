
<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>JP Flash (Final)</title>
  <script>
    tailwind = { darkMode: 'class' };
  </script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-gray-100 p-4">
  <div class="max-w-xl mx-auto space-y-4">
    <div class="flex justify-between items-center">
      <h1 class="text-2xl font-bold">JP Flash</h1>
      <div class="flex gap-2">
        <button onclick="goHome()" class="text-xl">üè†</button>
        <button onclick="toggleDarkMode()" id="darkToggle" class="text-xl">üåô</button>
      </div>
    </div>
    <div id="mainPanel">Loading...</div>
  </div>

<script>
let currentCards = [], currentIndex = 0, flipped = false;
let mode = "flashcard", group = "", file = "", score = { correct: 0, total: 0 };
let isInputMode = false;

// UI generation (simplified from saved base)
document.addEventListener("DOMContentLoaded", () => {
  document.getElementById("mainPanel").innerHTML = `
    <p class="text-lg font-medium">Select a Category</p>
    <select id="categoryDropdown" class="w-full p-2 rounded bg-gray-200 dark:bg-gray-700 text-black dark:text-white mt-2">
      <option value="">-- Select Category --</option>
      <option value="verbs">Verbs</option>
      <option value="nouns">Nouns</option>
      <option value="adjectives">Adjectives</option>
      <option value="counters">Counters</option>
      <option value="kana">Kana</option>
      <option value="kanji">Kanji</option>
    </select>
    <div id="subcategoryWrapper" class="mt-4 hidden">
      <p class="text-lg font-medium">Select a Subcategory</p>
      <select id="subcategoryDropdown" class="w-full p-2 rounded bg-gray-200 dark:bg-gray-700 text-black dark:text-white mt-2"></select>
    </div>
    <div id="modeButtons" class="hidden mt-4 flex gap-2 justify-center">
      <button onclick="startMode('flashcard')" class="btn bg-purple-600">Flashcard</button>
      <button onclick="startMode('input')" class="btn bg-blue-600">Input</button>
    </div>
    <div id="practicePanel" class="hidden mt-6 space-y-4">
      <div id="prompt" class="text-xl font-semibold p-4 rounded-xl bg-gray-200 dark:bg-gray-700 min-h-[5rem] cursor-pointer text-center" onclick="flipCard()">...</div>
      <div id="inputSection" class="hidden">
        <input id="userInput" class="w-full p-2 rounded text-black" placeholder="Type your answer..." />
        <button onclick="submitAnswer()" class="btn bg-blue-600 w-full mt-2">Submit</button>
        <div id="feedback" class="min-h-[1.5rem] text-center"></div>
        <div id="scoreDisplay" class="text-sm text-center mt-1"></div>
      </div>
      <button onclick="nextCard()" class="btn w-full bg-purple-600">Next</button>
    </div>
  `;

  document.getElementById("categoryDropdown").addEventListener("change", onCategoryChange);
});

function toggleDarkMode() {
  const root = document.documentElement;
  const toggle = document.getElementById("darkToggle");
  const isDark = root.classList.toggle("dark");
  toggle.textContent = isDark ? "üåô" : "‚òÄÔ∏è";
}

function goHome() {
  location.reload();
}

function onCategoryChange() {
  group = document.getElementById("categoryDropdown").value;
  fetch("subcategory_index.json").then(r => r.json()).then(data => {
    const subs = data[group] || [];
    const subSelect = document.getElementById("subcategoryDropdown");
    subSelect.innerHTML = subs.map(s => `<option value="${s}">${s.replace('.json','').replace(/_/g,' ')}</option>`).join('');
    document.getElementById("subcategoryWrapper").classList.remove("hidden");
    document.getElementById("modeButtons").classList.remove("hidden");
  });
}

function startMode(selectedMode) {
  mode = selectedMode;
  isInputMode = mode === "input";
  score.correct = 0;
  score.total = 0;
  currentIndex = 0;
  file = document.getElementById("subcategoryDropdown").value;

  fetch(`${group}/${file}`).then(res => res.json()).then(data => {
    currentCards = data.sort(() => Math.random() - 0.5);
    document.getElementById("practicePanel").classList.remove("hidden");
    updateCard();
  });
}

function updateCard() {
  const word = currentCards[currentIndex];
  document.getElementById("inputSection").classList.toggle("hidden", !isInputMode);
  document.getElementById("feedback").textContent = "";
  document.getElementById("scoreDisplay").textContent = `${score.correct} / ${score.total} correct`;
  document.getElementById("userInput")?.focus();

  document.getElementById("prompt").innerHTML = isInputMode
    ? word.english
    : flipped ? `${word.romaji}<br>${word.hiragana}` : word.english;
}

function flipCard() {
  if (!isInputMode) {
    flipped = !flipped;
    updateCard();
  }
}

function submitAnswer() {
  const input = document.getElementById("userInput").value.trim().toLowerCase();
  const correct = currentCards[currentIndex].romaji.toLowerCase();
  score.total++;
  if (input === correct) {
    score.correct++;
    document.getElementById("feedback").textContent = "‚úÖ Correct!";
    document.getElementById("feedback").className = "text-green-500 font-bold";
  } else {
    document.getElementById("feedback").textContent = `‚ùå Correct: ${correct}`;
    document.getElementById("feedback").className = "text-red-500 font-bold";
  }
  updateCard();
}

function nextCard() {
  currentIndex = (currentIndex + 1) % currentCards.length;
  flipped = false;
  updateCard();
}
</script>

<style>
.btn {
  padding: 0.5rem 1rem;
  border-radius: 0.5rem;
  background-color: #8b5cf6;
  color: white;
  font-weight: 500;
}
.btn:hover {
  background-color: #7c3aed;
}
</style>
</body>
</html>
